window.twotransfair=window.twotransfair||{},twotransfair.server_url="https://24d5dda8.ngrok.io/api",twotransfair.shop_domain="pruebasjamar.myshopify.com",twotransfair.cart_id="abc12345",function(a){a.fn.twotransfairModal=function(t=null){var o=this,s=t;return a(this).find(".modal-dismiss, .modal-close").click(function(){o.hideModal(),a(".modal-overlay").hide()}),a(this).find(".modal-back").click(function(){o.hideModal(),1==twotransfair.step?twotransfair.ajax_step_1.showModal():2==twotransfair.step&&twotransfair.ajax_step_2.showModal()}),this.showModal=function(){a(this).css("display","flex")},this.hideModal=function(){a(this).hide()},this.showMsg=function(t){a(this).find(".modal-msg").html(t).show()},this.hideMsg=function(){a(this).find(".modal-msg").hide()},this.showMsgModal=function(a){this.hideModal(),s.find("#twotransfair_failed_msg").html(a),s.showModal()},this.sendAjax=function(t,s){this.hideModal(),this.hideMsg(),a.ajax({method:"post",dataType:"json",crossDomain:!0,url:t.url,data:t.data,success:function(t){if(1==t.code){if(1==twotransfair.step){a("#twotransfair_phone_number").html(t.phone_number),twotransfair.total_value=t.total_value;var r=parseFloat(t.total_value).toFixed(2).replace(/\d(?=(\d{3})+\.)/g,"$&,");a("#twotransfair_total_value").html(r),a("#twotransfair_policy_url").attr("href",t.url),t.terms.forEach(t=>{a("#twotransfair_terms").append(a("<option></option>").attr("value",t.id).text(t.name))}),twotransfair.step=2}else if(2==twotransfair.step){var i=parseFloat(t.discount_amount).toFixed(2).replace(/\d(?=(\d{3})+\.)/g,"$&,");a("#twotransfair_discount_amount").html(i),twotransfair.access_token=t.access_token,twotransfair.discount_code=t.discount_code,a("#twotransfair_success_msg").html(t.msg)}s.showModal()}else o.showMsgModal(t.msg)},error:function(){o.showMsg("Error de servidor interno"),o.showModal()}})},this};a(document).ready(function(){var t=a("#twotransfair_msg_modal").twotransfairModal(),o=a("#twotransfair_step1_modal").twotransfairModal(t),s=a("#twotransfair_step2_modal").twotransfairModal(t);twotransfair.ajax_step_1=s;var r=a("#twotransfair_step3_modal").twotransfairModal(t);twotransfair.ajax_step_2=r;var i=a("#twotransfair_step4_modal").twotransfairModal(t),n=a("#twotransfair_step5_modal").twotransfairModal(t);o.showModal(),a("#twotransfair_step1_next").click(function(){o.hideModal(),s.showModal()}),a("#twotransfair_step2_next").click(function(){var t=a("#twotransfair_email").val();if(!function(a){return!!/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(String(a).toLowerCase())}(t)||t.length<3)s.showMsg("Email inválido");else{var o=a("#twotransfair_password").val();o.length<1?s.showMsg("Contraseña inválido"):(twotransfair.step=1,s.sendAjax({url:twotransfair.server_url+"/login",data:{email:t,password:o,shop_domain:twotransfair.shop_domain}},r))}}),a("#twotransfair_step3_next").click(function(){if(a("#twotransfair_agree").prop("checked")){var t=a("#twotransfair_payment_code").val();if(/^\d+$/.test(t)&&6==t.length)r.hideModal(),r.hideMsg(),i.showModal();else r.showMsg("Código inválido")}else r.showMsg("Acepte los términos de crédito para continuar")}),a("#twotransfair_step4_next").click(function(){var t=a("#twotransfair_email").val(),o=a("#twotransfair_payment_code").val(),s=twotransfair.total_value,r=a("#twotransfair_terms").val();i.sendAjax({url:twotransfair.server_url+"/verify",data:{email:t,payment_code:o,reference_code:twotransfair.cart_id,value:s,terms:r,shop_domain:twotransfair.shop_domain}},n)}),a("#twotransfair_modals_wrapper").show()})}(jQuery);